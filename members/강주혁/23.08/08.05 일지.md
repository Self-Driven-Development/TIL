---
description: ky instanceì˜ response íƒ€ì… ë°”ê¾¸ê¸°, ìì‹ ì»´í¬ë„ŒíŠ¸ì—ê²Œ ë¹„ë™ê¸° ë°ì´í„°ë¥¼ propsë¡œ ì „ë‹¬í•˜ê¸° vs ìì‹ ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì—ì„œ ë¹„ë™ê¸° ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê¸°
keywords: [ky, react-query, kyInstance]
---

# 23.08.05

## ì˜¤ëŠ˜ í•œ ì¼

- í”„ë¡œê·¸ë¼í”¼ ì„¸ì…˜ ì°¸ì—¬
- ì¹´ê³µì‹¤ë¡ ë¦¬íŒ©í† ë§

---

## ky instanceì˜ response íƒ€ì… ë°”ê¾¸ê¸°

### ë¬¸ì œ

ëì— `.json`ê³¼ genericìœ¼ë¡œ `APIResponse`ë¥¼ ë¶™ì—¬ì£¼ì–´ì•¼ í•˜ëŠ” ë¶ˆí¸í•¨ì´ ìˆì—ˆë‹¤.

```tsx
export const getPlace = async (id: number) => {
  const { data } = await api.get(`api/v1/places/${id}`).json<APIResponse<Place>>();

  return data;
};
```

APIResponse íƒ€ì…ì€ ì´ë ‡ë‹¤.

```tsx
interface APIResponse<T> {
  result?: string;
  message?: string;
  data: T;
}
```

### í•´ê²°

`create`ë¡œ ë§Œë“  ky instanceë¥¼ í†µí•´ `api`ë¼ëŠ” ê°ì²´ë¥¼ ë§Œë“¤ì—ˆë‹¤.

get, post, put, delete ë©”ì„œë“œë¥¼ ë§Œë“¤ì–´ì„œ json ë©”ì„œë“œê¹Œì§€ í˜¸ì¶œí•˜ë„ë¡ í–ˆë‹¤.

```ts {18-24}
import { retryRequest } from './retryRequest';
import { setHeader } from './setHeader';
import ky from 'ky';

import type { Input, Options } from 'ky/distribution/types/options';

const instance = ky.create({
  prefixUrl: process.env.NEXT_PUBLIC_API_URL,
  headers: {
    'Content-Type': 'application/json',
  },
  hooks: {
    beforeRequest: [setHeader],
    afterResponse: [retryRequest],
  },
});

const api = {
  get: <T>(url: Input, options?: Options) => instance.get(url, options).json<APIResponse<T>>(),
  post: <T>(url: Input, options?: Options) => instance.post(url, options).json<APIResponse<T>>(),
  put: <T>(url: Input, options?: Options) => instance.put(url, options).json<APIResponse<T>>(),
  delete: <T>(url: Input, options?: Options) =>
    instance.delete(url, options).json<APIResponse<T>>(),
};

export default api;
```

### ê²°ê³¼

ê¹”ë”í•´ì¡Œë‹¤âœ¨

```diff
- const { data } = await api.get(`api/v1/places/${id}`).json<APIResponse<Place>>();
+ const { data } = await api.get<Place>(`api/v1/places/${id}`);
```

## ğŸ¤”ìì‹ ì»´í¬ë„ŒíŠ¸ì—ê²Œ ë¹„ë™ê¸° ë°ì´í„°ë¥¼ propsë¡œ ì „ë‹¬í•˜ê¸° vs ìì‹ ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì—ì„œ ë¹„ë™ê¸° ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê¸°

### 1. ìì‹ ì»´í¬ë„ŒíŠ¸ì—ê²Œ ë¹„ë™ê¸° ë°ì´í„°ë¥¼ propsë¡œ ì „ë‹¬í•˜ê¸°

```tsx
function Parent() {
  const { data } = useGetData();

  return (
    <>
      <Child1 data={data} />
      <Child2 data={data} />
    </>
  );
}
```

### 2. ìì‹ ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì—ì„œ ë¹„ë™ê¸° ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê¸°

```tsx
function Parent() {
  const { data } = useGetData();

  return (
    <>
      <Child1 />
      <Child2 />
    </>
  );
}

function Child1() {
  const { data } = useGetData();

  return <div>{data}</div>;
}

function Child2() {
  const { data } = useGetData();

  return <div>{data}</div>;
}
```

### ë‚´ ìƒê°

ìƒí™©ì— ë”°ë¼ ë‹¤ë¥¼ ê²ƒ ê°™ë‹¤.

- 1ë²ˆì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš°

  - depthê°€ ê¹Šì§€ ì•Šì„ ë•Œ
  - ìì‹ ì»´í¬ë„ŒíŠ¸ê°€ íŠ¹ì • ë„ë©”ì¸ì— ì¢…ì†ë˜ì§€ ì•Šì•„ì•¼ í•  ë•Œ

- 2ë²ˆì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš°
  - depthê°€ ê¹Šì„ ë•Œ

### react query ë©”ì¸í…Œì´ë„ˆ(TKDodo)ì˜ ì˜ê²¬

Discussionì— Context APIì™€ RQë¥¼ ê°™ì´ ì‚¬ìš©í•˜ëŠ”ì§€ì— ëŒ€í•œ [ì§ˆë¬¸](https://github.com/TanStack/query/discussions/3859)ì´ ìˆì—ˆë‹¤.

TKDodoëŠ” ì¼ë°˜ì ìœ¼ë¡œëŠ” ì»¤ìŠ¤í…€ useQuery í›…ì„ **í•„ìš”í•  ë•Œë§ˆë‹¤ í˜¸ì¶œ**í•˜ëŠ” ê²ƒì„ ì„ í˜¸í•œë‹¤ê³  í•œë‹¤. ê·¸ë ‡ì§€ë§Œ Context APIë„ ë‚˜ì˜ì§€ ì•Šì€ ë°©ë²•ì´ë¼ê³  í•œë‹¤. ë‹¤ë§Œ ëª¨ë“  íŠ¸ë¦¬ê°€ ì¬ë Œë”ë§ë˜ëŠ”ê±¸ ë§‰ê¸° ìœ„í•´ ë©”ëª¨ì´ì œì´ì…˜í•´ë‘ì–´ì•¼ í•œë‹¤ê³  í•œë‹¤.

## ë‚´ì¼ í•  ì¼

- gloddy ê°œë°œ
- ì¹´ê³µì‹¤ë¡ ê°œë°œ
